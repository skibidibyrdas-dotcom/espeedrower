<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Speedrower League Junior</title>
<link rel="icon" href="data:," />
<style>
  :root{
    --bg:#040406; --card:#0f1113; --muted:#9aa0a6;
    --g1:#7ff08a; --g2:#b070ff; --glass: rgba(255,255,255,0.03);
    --radius:14px; --maxw:1200px; --accentText:#081013;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter,system-ui,Arial,sans-serif; color:#eef3f6;
    background:
      radial-gradient(1200px 600px at 10% 10%, rgba(127,240,138,0.06), transparent 6%),
      radial-gradient(1000px 500px at 90% 85%, rgba(176,112,255,0.04), transparent 6%),
      linear-gradient(180deg,#020203,var(--bg));
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height:100vh;
  }
  .wrap{max-width:var(--maxw);margin:20px auto;padding:18px}
  /* --- POPRAWIONY BANER --- */
  .hero{
    display:flex;align-items:center;justify-content:space-between;gap:12px;
    background:linear-gradient(90deg,var(--g1),var(--g2));
    border-radius:18px;padding:18px;color:#ffffff; /* <-- tekst bia≈Çy dla kontrastu */
    box-shadow:0 18px 50px rgba(0,0,0,0.45);
    position:relative;
    overflow:hidden;
  }
  .hero h1{margin:0;font-size:22px;line-height:1.05;color:#ffffff;font-weight:900;text-shadow:0 4px 18px rgba(0,0,0,0.45)}
  .hero .small{color:rgba(255,255,255,0.92);margin-top:6px}
  .hero .tag{background:rgba(0,0,0,0.06);padding:6px 10px;border-radius:999px;font-weight:800;color:#071011}
  /* ------------------------- */
  nav{display:flex;flex-wrap:wrap;gap:8px;margin:14px 0}
  .btn{background:rgba(255,255,255,0.95);color:#071011;padding:8px 12px;border-radius:12px;border:none;cursor:pointer;font-weight:800}
  .btn-ghost{background:transparent;color:inherit;padding:8px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);padding:14px;border-radius:14px;border:1px solid var(--glass);box-shadow:0 10px 30px rgba(0,0,0,0.55)}
  h2{margin:0 0 6px 0}
  .small{font-size:13px;color:var(--muted)}
  input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit;margin-top:8px}
  .news-item{border-left:4px solid var(--g2);padding:12px;border-radius:8px;background:linear-gradient(180deg, rgba(176,112,255,0.03), transparent);margin-bottom:12px}
  .news-images{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
  .news-images img{max-width:160px;border-radius:8px;cursor:pointer;border:1px solid rgba(255,255,255,0.03);transition:transform .18s}
  .news-images img:hover{transform:scale(1.03)}
  .ticker{background:linear-gradient(90deg,rgba(0,0,0,0.12),transparent);padding:8px;border-radius:12px;overflow:hidden;position:relative}
  .ticker .inner{display:inline-block;white-space:nowrap;animation:marquee 14s linear infinite}
  @keyframes marquee{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:800;border:1px solid rgba(255,255,255,0.02)}
  .fancyTitle{background:linear-gradient(90deg,var(--g1),var(--g2));-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:900}
  .footer{color:var(--muted);text-align:center;margin:18px 0}
  .hidden{display:none}
  .card:hover{transform:translateY(-6px);transition:transform .18s}
  #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:30px;background:linear-gradient(90deg,var(--g1),var(--g2));color:#071011;padding:12px 18px;border-radius:999px;box-shadow:0 12px 40px rgba(0,0,0,0.5);display:none;z-index:20000}
  #confetti{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:20000}
</style>
</head>
<body>
<div class="wrap">
  <div class="hero">
    <div>
      <h1>Speedrower League Junior</h1>
      <div class="small">Liga junior√≥w do 18 lat ‚Äî terminarz, kluby, aktualno≈õci</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <div class="tag">Ziele≈Ñ ‚Ä¢ Fiolet</div>
      <button id="openPanelBtn" class="btn-ghost">Panel organizatora</button>
      <a class="btn" href="https://skibidibyrdas-dotcom.github.io/espeedrower/" target="_blank">Odwied≈∫ stronƒô</a>
    </div>
  </div>

  <div style="margin-top:12px" class="ticker card">
    <div id="tickerInner" class="inner small">≈Åadowanie najbli≈ºszego meczu...</div>
  </div>

  <nav>
    <button class="btn-ghost" data-show="home">Start</button>
    <button class="btn-ghost" data-show="news">Aktualno≈õci</button>
    <button class="btn-ghost" data-show="clubs">Kluby</button>
    <button class="btn-ghost" data-show="schedule">Terminarz</button>
    <button class="btn-ghost" data-show="standings">Tabela</button>
  </nav>

  <div class="grid" style="margin-top:12px">
    <main>
      <section id="home" class="card view">
        <h2>Witaj</h2>
        <p class="small">U≈ºyj Panelu organizatora (has≈Ço) aby dodaƒá aktualno≈õci, kluby i mecze ‚Äî wszystko zapisywane jest w Firebase i widoczne dla wszystkich.</p>
        <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
          <div class="card" style="flex:1;min-width:240px">
            <h3 style="margin:0">Szybkie statystyki</h3>
            <div id="stats" class="small" style="margin-top:8px">≈Åadowanie...</div>
          </div>
          <div class="card" style="min-width:280px">
            <h3 style="margin:0">Wyr√≥≈ºnione</h3>
            <div style="margin-top:8px"><strong>Speedrower League Junior</strong> ‚Äî ≈õwie≈ºe aktualno≈õci i mecze.</div>
          </div>
        </div>
      </section>

      <section id="news" class="card view hidden">
        <h2 style="color:var(--g2)">Aktualno≈õci</h2>
        <div id="newsList" style="margin-top:12px"></div>
      </section>

      <section id="clubs" class="card view hidden">
        <h2>Kluby</h2>
        <div id="clubsList" style="margin-top:12px"></div>
      </section>

      <section id="schedule" class="card view hidden">
        <h2>Terminarz</h2>
        <div id="scheduleList" style="margin-top:12px"></div>
      </section>

      <section id="standings" class="card view hidden">
        <h2>Tabela</h2>
        <div id="standingsList" style="margin-top:12px"></div>
      </section>

      <section id="contact" class="card" style="margin-top:12px">
        <h3>Kontakt</h3>
        <p class="small">üìû 792 606 955 ‚Ä¢ üìß <a href="mailto:espeedrower@gmail.com" style="color:var(--g1)">espeedrower@gmail.com</a></p>
      </section>
    </main>

    <aside>
      <div class="card">
        <h4 style="margin:0">Szybkie akcje</h4>
        <div style="margin-top:8px;display:flex;flex-direction:column;gap:8px">
          <button class="btn" data-show="news">Aktualno≈õci</button>
          <button class="btn" data-show="clubs">Kluby</button>
          <button class="btn" data-show="schedule">Terminarz</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h4 style="margin:0">Backup</h4>
        <div style="margin-top:8px" class="small">Eksportuj/Importuj JSON z bazy (przydatne do kopii).</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="exportAll" class="btn">Eksportuj</button>
          <label class="btn-ghost" style="cursor:pointer;padding:8px 10px;border-radius:8px">Import<input id="importAll" type="file" accept=".json" style="display:none"/></label>
        </div>
      </div>
    </aside>
  </div>

  <div class="footer">¬© 2025 Speedrower League Junior ‚Äî wersja z has≈Çem</div>
</div>

<!-- panel modal -->
<div id="panelModal" class="modal hidden">
  <div class="modal-box">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div><strong style="color:var(--g1)">Panel organizatora</strong><div class="small">Wpisz has≈Ço, aby zarzƒÖdzaƒá</div></div>
      <div><button id="closePanel" class="btn-ghost">Zamknij</button></div>
    </div>

    <hr style="margin:10px 0"/>

    <div id="loginWrap">
      <label class="small">Has≈Ço:</label>
      <input id="adminPass" type="password" class="input" placeholder="Has≈Ço organizatora"/>
      <div style="margin-top:8px"><button id="loginBtn" class="btn">Zaloguj</button></div>
      <div class="small" style="margin-top:8px;color:var(--muted)">Has≈Ço jest przechowywane lokalnie w sesji. Zmie≈Ñ ADMIN_PASS w kodzie, je≈õli chcesz inne.</div>
    </div>

    <div id="adminControls" class="hidden" style="margin-top:12px">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="card">
          <h4>Dodaj klub</h4>
          <input id="clubName" class="input" placeholder="Nazwa"/>
          <input id="clubCity" class="input" placeholder="Miasto"/>
          <input id="clubShort" class="input" placeholder="Skr√≥t"/>
          <textarea id="clubDesc" class="input" rows="3" placeholder="Opis"></textarea>
          <input id="clubAchievements" class="input" placeholder="OsiƒÖgniƒôcia (oddziel przecinkiem)"/>
          <input id="clubRoster" class="input" placeholder="Sk≈Çad (oddziel przecinkiem)"/>
          <label class="small">Kategorie</label>
          <select id="clubCats" multiple size="4" class="input"><option>U10</option><option>U13</option><option>U16</option><option>U18</option></select>
          <div style="display:flex;gap:8px;margin-top:8px"><button id="saveClub" class="btn">Zapisz</button><button id="clearClub" class="btn-ghost">Wyczy≈õƒá</button></div>
        </div>

        <div class="card">
          <h4>Dodaj mecz / wynik</h4>
          <input id="matchDate" class="input" type="date"/>
          <input id="matchTime" class="input" type="time"/>
          <input id="matchHome" class="input" placeholder="Gospodarz"/>
          <input id="matchAway" class="input" placeholder="Go≈õƒá"/>
          <input id="matchPlace" class="input" placeholder="Miejsce"/>
          <select id="matchCat" class="input"><option>U10</option><option>U13</option><option>U16</option><option>U18</option></select>
          <div style="display:flex;gap:8px;margin-top:8px"><input id="matchHomeGoals" class="input" type="number" min="0" placeholder="Gosp - pkt" style="width:48%"/><input id="matchAwayGoals" class="input" type="number" min="0" placeholder="Go≈õƒá - pkt" style="width:48%"/></div>
          <div style="display:flex;gap:8px;margin-top:8px"><button id="saveMatch" class="btn">Dodaj</button><button id="clearMatch" class="btn-ghost">Wyczy≈õƒá</button></div>
        </div>

        <div class="card" style="grid-column:1 / -1">
          <h4>Dodaj aktualno≈õƒá (ze zdjƒôciami)</h4>
          <input id="newsTitle" class="input" placeholder="Tytu≈Ç"/>
          <textarea id="newsContent" class="input" rows="3" placeholder="Tre≈õƒá"></textarea>
          <input id="newsFiles" type="file" accept="image/*" multiple class="input"/>
          <div style="display:flex;gap:8px;margin-top:8px"><button id="addNews" class="btn">Dodaj aktualno≈õƒá</button><button id="clearNews" class="btn-ghost">Wyczy≈õƒá</button></div>
        </div>
      </div>

      <hr style="margin:10px 0"/>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="exportAll" class="btn">Eksport (JSON)</button>
        <label class="btn-ghost" style="cursor:pointer;padding:8px 10px;border-radius:8px">Import<input id="importAll" type="file" accept=".json" style="display:none"/></label>
      </div>
    </div>
  </div>
</div>

<div id="toast">Gotowe!</div>
<canvas id="confetti"></canvas>

<!-- Firebase modules -->
<script type="module">
  const ADMIN_PASS = 'Speedrower';

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
  import { getStorage, ref as sref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDNi83_zoH8cDSpYoTS4XtoGLPDKnypG1A",
    authDomain: "speedrower-junior-league.firebaseapp.com",
    projectId: "speedrower-junior-league",
    storageBucket: "speedrower-junior-league.firebasestorage.app",
    messagingSenderId: "151487950214",
    appId: "1:151487950214:web:54742c6cae06f267661007",
    measurementId: "G-BTW6P3QMS3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const showBtns = document.querySelectorAll('[data-show]');
  const views = document.querySelectorAll('.view');
  const openPanelBtn = document.getElementById('openPanelBtn');
  const panelModal = document.getElementById('panelModal');
  const closePanel = document.getElementById('closePanel');
  const loginBtn = document.getElementById('loginBtn');
  const adminPassInput = document.getElementById('adminPass');
  const loginWrap = document.getElementById('loginWrap');
  const adminControls = document.getElementById('adminControls');
  const toast = document.getElementById('toast');
  const confettiCanv = document.getElementById('confetti');
  const tickerInner = document.getElementById('tickerInner');

  showBtns.forEach(b=> b.addEventListener('click', ()=> {
    const id = b.dataset.show;
    views.forEach(v=> v.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    window.scrollTo({top:0,behavior:'smooth'});
  }));
  views.forEach(v=> v.classList.add('hidden'));
  document.getElementById('home').classList.remove('hidden');

  openPanelBtn.addEventListener('click', ()=> {
    panelModal.classList.remove('hidden');
    if(sessionStorage.getItem('sr_admin')==='1') { adminControls.classList.remove('hidden'); loginWrap.classList.add('hidden'); }
  });
  closePanel.addEventListener('click', ()=> panelModal.classList.add('hidden'));

  function showToast(msg, t=2200){ toast.textContent = msg; toast.style.display='block'; setTimeout(()=> toast.style.display='none', t); }
  function popConfetti(){
    const c = confettiCanv; const ctx = c.getContext('2d'); c.width = innerWidth; c.height = innerHeight;
    const pieces = Array.from({length:60}).map(()=>({x: Math.random()*c.width,y: -20 - Math.random()*200,vx: (Math.random()-0.5)*6,vy: 2+Math.random()*6,w: 6+Math.random()*10,h: 6+Math.random()*10,col: Math.random()>0.5 ? '#7ff08a' : '#b070ff',rot: Math.random()*360}));
    let t=0; const raf = ()=> { t++; ctx.clearRect(0,0,c.width,c.height); pieces.forEach(p=>{ p.x += p.vx; p.y += p.vy; p.vy += 0.12; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot * Math.PI/180); ctx.fillStyle = p.col; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore(); }); if(t<160) requestAnimationFrame(raf); else ctx.clearRect(0,0,c.width,c.height); }; raf();
  }

  // News
  const newsList = document.getElementById('newsList');
  async function loadNews(){
    newsList.innerHTML = '≈Åadowanie...';
    try {
      const q = query(collection(db,'aktualnosci'), orderBy('createdAt','desc'));
      const snap = await getDocs(q);
      newsList.innerHTML = '';
      if(snap.empty) { newsList.innerHTML = '<div class="small">Brak aktualno≈õci.</div>'; return; }
      snap.forEach(d=>{
        const n = d.data();
        const date = n.createdAt && n.createdAt.toDate ? n.createdAt.toDate().toLocaleString() : (n.date||'');
        const div = document.createElement('div'); div.className='news-item';
        let imgs = '';
        if(n.images && n.images.length) imgs = '<div class="news-images">' + n.images.map(u=> `<img src="${u}" onclick="window.open('${u}','_blank')">`).join('') + '</div>';
        div.innerHTML = `<strong>${escapeHtml(n.title)}</strong><div class="small">${date}${n.author?(' ‚Ä¢ '+escapeHtml(n.author)):""}</div><div style="margin-top:8px">${escapeHtml(n.content)}</div>${imgs}`;
        newsList.appendChild(div);
      });
    } catch(e){ newsList.innerHTML = '<div class="small">B≈ÇƒÖd wczytywania aktualno≈õci.</div>'; console.error(e); }
  }

  async function uploadFiles(files){
    if(!files || files.length===0) return [];
    const urls = [];
    for(const f of files){
      const path = `news_images/${Date.now()}_${Math.random().toString(36).slice(2,8)}_${f.name}`;
      const ref = sref(storage, path);
      await uploadBytes(ref, f);
      const url = await getDownloadURL(ref);
      urls.push(url);
    }
    return urls;
  }

  document.getElementById('addNews').addEventListener('click', async ()=>{
    if(sessionStorage.getItem('sr_admin')!=='1') return alert('Zaloguj siƒô has≈Çem w panelu.');
    const title = document.getElementById('newsTitle').value.trim();
    const content = document.getElementById('newsContent').value.trim();
    const files = document.getElementById('newsFiles').files;
    if(!title || !content) return alert('Wype≈Çnij tytu≈Ç i tre≈õƒá.');
    const btn = document.getElementById('addNews'); btn.disabled=true; btn.textContent='Dodawanie...';
    try {
      const imgs = await uploadFiles(files);
      await addDoc(collection(db,'aktualnosci'), { title, content, images: imgs, author: 'Organizer (has≈Ço)', createdAt: serverTimestamp() });
      document.getElementById('newsTitle').value=''; document.getElementById('newsContent').value=''; document.getElementById('newsFiles').value='';
      showToast('Aktualno≈õƒá dodana'); popConfetti(); loadNews(); updateTicker(); updateStats();
    } catch(e){ alert('B≈ÇƒÖd: '+e.message); console.error(e); } finally { btn.disabled=false; btn.textContent='Dodaj aktualno≈õƒá'; }
  });

  document.getElementById('clearNews').addEventListener('click', ()=> { document.getElementById('newsTitle').value=''; document.getElementById('newsContent').value=''; document.getElementById('newsFiles').value=''; });

  // Clubs
  const clubsList = document.getElementById('clubsList');
  async function loadClubs(){
    clubsList.innerHTML = '';
    try {
      const snap = await getDocs(collection(db,'kluby'));
      if(snap.empty){ clubsList.innerHTML = '<div class="small">Brak klub√≥w.</div>'; return; }
      snap.forEach(s=>{
        const c = s.data();
        const div = document.createElement('div'); div.className='card';
        div.innerHTML = `<strong>${escapeHtml(c.name)}</strong><div class="small">${escapeHtml(c.city||'')} ${c.short?('‚Ä¢ '+escapeHtml(c.short)):""}</div><div style="margin-top:8px">${escapeHtml(c.description||'')}</div>`;
        if(sessionStorage.getItem('sr_admin')==='1'){ const ctrl = document.createElement('div'); ctrl.style.marginTop='8px'; ctrl.innerHTML = `<button class="btn-ghost" onclick="window.editClub('${s.id}')">Edytuj</button> <button class="btn-ghost" onclick="window.deleteClub('${s.id}')">Usu≈Ñ</button>`; div.appendChild(ctrl); }
        clubsList.appendChild(div);
      });
    } catch(e){ clubsList.innerHTML = '<div class="small">B≈ÇƒÖd ≈Çadowania klub√≥w.</div>'; console.error(e); }
  }

  document.getElementById('saveClub').addEventListener('click', async ()=>{
    if(sessionStorage.getItem('sr_admin')!=='1') return alert('Zaloguj siƒô has≈Çem.');
    const name = document.getElementById('clubName').value.trim(); if(!name) return alert('Nazwa klubu wymagana.');
    const data = { name, city: document.getElementById('clubCity').value.trim(), short: document.getElementById('clubShort').value.trim(), description: document.getElementById('clubDesc').value.trim(), achievements: (document.getElementById('clubAchievements').value||'').split(',').map(s=>s.trim()).filter(Boolean), roster: (document.getElementById('clubRoster').value||'').split(',').map(s=>s.trim()).filter(Boolean), categories: Array.from(document.getElementById('clubCats').selectedOptions).map(o=>o.value), createdAt: serverTimestamp(), author: 'Organizer (has≈Ço)' };
    try { await addDoc(collection(db,'kluby'), data); showToast('Dodano klub'); loadClubs(); updateStats(); } catch(e){ alert('B≈ÇƒÖd: '+e.message); }
  });

  window.deleteClub = async function(id){ if(!confirm('UsunƒÖƒá klub?')) return; try { await deleteDoc(doc(db,'kluby',id)); loadClubs(); updateStats(); } catch(e){ alert('B≈ÇƒÖd: '+e.message); } };
  document.getElementById('clearClub').addEventListener('click', ()=> { document.getElementById('clubName').value=''; document.getElementById('clubCity').value=''; document.getElementById('clubShort').value=''; document.getElementById('clubDesc').value=''; document.getElementById('clubAchievements').value=''; document.getElementById('clubRoster').value=''; Array.from(document.getElementById('clubCats').options).forEach(o=>o.selected=false); });

  // Matches
  const scheduleList = document.getElementById('scheduleList');
  async function loadMatches(){ scheduleList.innerHTML = ''; try { const snap = await getDocs(query(collection(db,'mecze'), orderBy('date','asc'))); if(snap.empty){ scheduleList.innerHTML = '<div class="small">Brak mecz√≥w.</div>'; return; } const table = document.createElement('table'); table.className='table'; table.innerHTML = '<thead><tr><th>Data</th><th>Godz.</th><th>Mecz</th><th>Kategoria</th><th>Miejsce</th><th>Wynik</th><th>Akcje</th></tr></thead>'; const tb = document.createElement('tbody'); snap.forEach(s=>{ const m = s.data(); const tr = document.createElement('tr'); const res = (typeof m.homeGoals==='number' && typeof m.awayGoals==='number') ? `${m.homeGoals} : ${m.awayGoals}` : '-'; tr.innerHTML = `<td>${escapeHtml(m.date||'')}</td><td>${escapeHtml(m.time||'')}</td><td>${escapeHtml(m.home)} ‚Äî ${escapeHtml(m.away)}</td><td>${escapeHtml(m.category||'')}</td><td>${escapeHtml(m.place||'')}</td><td>${res}</td><td></td>`; const td = tr.querySelector('td:last-child'); if(sessionStorage.getItem('sr_admin')==='1'){ const del = document.createElement('button'); del.className='btn-ghost'; del.textContent='Usu≈Ñ'; del.onclick = async ()=> { if(confirm('UsunƒÖƒá mecz?')){ await deleteDoc(doc(db,'mecze',s.id)); loadMatches(); renderStandings(); updateTicker(); } }; td.appendChild(del); } tb.appendChild(tr); }); table.appendChild(tb); scheduleList.appendChild(table); } catch(e){ scheduleList.innerHTML = '<div class="small">B≈ÇƒÖd ≈Çadowania terminarza.</div>'; console.error(e); } }

  document.getElementById('saveMatch').addEventListener('click', async ()=>{ if(sessionStorage.getItem('sr_admin')!=='1') return alert('Zaloguj siƒô has≈Çem.'); const date = document.getElementById('matchDate').value; const time = document.getElementById('matchTime').value; const home = document.getElementById('matchHome').value.trim(); const away = document.getElementById('matchAway').value.trim(); const place = document.getElementById('matchPlace').value.trim(); const cat = document.getElementById('matchCat').value; const hg = document.getElementById('matchHomeGoals').value; const ag = document.getElementById('matchAwayGoals').value; if(!date || !home || !away) return alert('Wype≈Çnij datƒô, gospodarza i go≈õcia.'); const data = { date, time, home, away, place, category:cat, homeGoals: hg===''?null: Number(hg), awayGoals: ag===''?null: Number(ag), createdAt: serverTimestamp(), author: 'Organizer (has≈Ço)' }; try { await addDoc(collection(db,'mecze'), data); showToast('Mecz dodany'); loadMatches(); renderStandings(); updateTicker(); } catch(e){ alert('B≈ÇƒÖd: '+e.message); } });

  // Standings
  async function renderStandings(){ const el = document.getElementById('standingsList'); el.innerHTML = ''; try { const clubsSnap = await getDocs(collection(db,'kluby')); const matchesSnap = await getDocs(collection(db,'mecze')); if(clubsSnap.empty || matchesSnap.empty){ el.innerHTML = '<div class="small">Brak danych do wylicze≈Ñ.</div>'; return; } const map = {}; clubsSnap.forEach(c => { const d = c.data(); map[d.name] = { club: d.name, MP:0,P:0,W:0,D:0,L:0,GF:0,GA:0,GD:0 }; }); matchesSnap.forEach(mSnap => { const m = mSnap.data(); if(typeof m.homeGoals!=='number' || typeof m.awayGoals!=='number') return; if(!map[m.home] || !map[m.away]) return; map[m.home].MP++; map[m.away].MP++; map[m.home].GF += m.homeGoals; map[m.home].GA += m.awayGoals; map[m.away].GF += m.awayGoals; map[m.away].GA += m.homeGoals; if(m.homeGoals>m.awayGoals){ map[m.home].W++; map[m.home].P+=3; map[m.away].L++; } else if(m.homeGoals<m.awayGoals){ map[m.away].W++; map[m.away].P+=3; map[m.home].L++; } else { map[m.home].D++; map[m.away].D++; map[m.home].P++; map[m.away].P++; } }); Object.values(map).forEach(r=> r.GD = r.GF - r.GA); const sorted = Object.values(map).sort((a,b)=> (b.P - a.P) || (b.GD - a.GD) || (b.GF - a.GF)); const tbl = document.createElement('table'); tbl.className='table'; tbl.innerHTML = '<thead><tr><th>#</th><th>Klub</th><th>MP</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th></tr></thead>'; const tbody = document.createElement('tbody'); sorted.forEach((r,i)=> { const tr = document.createElement('tr'); tr.innerHTML = `<td>${i+1}</td><td>${escapeHtml(r.club)}</td><td>${r.MP}</td><td>${r.P}</td><td>${r.W}</td><td>${r.D}</td><td>${r.L}</td><td>${r.GF}</td><td>${r.GA}</td><td>${r.GD}</td>`; tbody.appendChild(tr); }); tbl.appendChild(tbody); el.appendChild(tbl); } catch(e){ el.innerHTML = '<div class="small">B≈ÇƒÖd przy wyliczaniu tabeli.</div>'; console.error(e); } }

  // Ticker
  async function updateTicker(){ try { const snap = await getDocs(query(collection(db,'mecze'), orderBy('date','asc'))); const arr = []; snap.forEach(s=> arr.push(s.data())); const now = new Date(); const upcoming = arr.filter(m => { if(!m.date) return false; const d = new Date(m.date + 'T' + (m.time||'00:00')); return d >= now; }).sort((a,b)=> (a.date+(a.time||'')) > (b.date+(b.time||'')) ? 1 : -1); if(upcoming.length===0){ tickerInner.textContent = 'Brak zaplanowanych mecz√≥w.'; } else { const m = upcoming[0]; tickerInner.innerHTML = `Najbli≈ºszy: <strong>${escapeHtml(m.home)} ‚Äî ${escapeHtml(m.away)}</strong> ‚Ä¢ ${escapeHtml(m.date)} ${escapeHtml(m.time||'') } ‚Ä¢ ${escapeHtml(m.place||'')}`; } } catch(e){ tickerInner.textContent = 'B≈ÇƒÖd ≈Çadowania terminarza.'; console.error(e); } }

  // Export/Import
  document.getElementById('exportAll').addEventListener('click', async ()=>{ if(!confirm('Pobraƒá backup wszystkich kolekcji?')) return; try { const [klubySnap, meczeSnap, newsSnap] = await Promise.all([getDocs(collection(db,'kluby')), getDocs(collection(db,'mecze')), getDocs(collection(db,'aktualnosci'))]); const data = { kluby: klubySnap.docs.map(d=>({id:d.id,data:d.data()})), mecze: meczeSnap.docs.map(d=>({id:d.id,data:d.data()})), aktualnosci: newsSnap.docs.map(d=>({id:d.id,data:d.data()})) }; const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'speedrower_backup.json'; a.click(); URL.revokeObjectURL(url); } catch(e){ alert('B≈ÇƒÖd eksportu: '+e.message); } });

  document.getElementById('importAll').addEventListener('change', async (e)=>{ if(sessionStorage.getItem('sr_admin')!=='1') return alert('Zaloguj siƒô has≈Çem.'); const f = e.target.files[0]; if(!f) return; const txt = await f.text(); try { const json = JSON.parse(txt); if(json.kluby){ for(const k of json.kluby) await addDoc(collection(db,'kluby'), k.data); } if(json.mecze){ for(const m of json.mecze) await addDoc(collection(db,'mecze'), m.data); } if(json.aktualnosci){ for(const n of json.aktualnosci) await addDoc(collection(db,'aktualnosci'), n.data); } showToast('Import zako≈Ñczony'); loadClubs(); loadMatches(); loadNews(); renderStandings(); updateTicker(); updateStats(); } catch(err){ alert('B≈ÇƒÖd importu: '+err.message); } });

  // Stats
  async function updateStats(){ try { const [klubySnap, meczeSnap, newsSnap] = await Promise.all([getDocs(collection(db,'kluby')), getDocs(collection(db,'mecze')), getDocs(collection(db,'aktualnosci'))]); document.getElementById('stats').innerHTML = `<strong>${klubySnap.size}</strong> kluby ‚Ä¢ <strong>${meczeSnap.size}</strong> mecz√≥w ‚Ä¢ <strong>${newsSnap.size}</strong> aktualno≈õci`; } catch(e){ document.getElementById('stats').innerHTML = '‚Äî'; } }

  // init
  await Promise.all([loadNews(), loadClubs(), loadMatches(), renderStandings(), updateTicker(), updateStats()]);

  function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }
</script>
</body>
</html>
